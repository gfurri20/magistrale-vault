## **27 ottobre 2025**

Ho iniziato i test base su due modelli:
- `meta-llama/llama-3.3-8b-instruct:free` molto approssimativo e impreciso
- `alibaba/tongyi-deepresearch-30b-a3b:free` spesso risposte che si avvicinano a quelle corrette, da approfondire. Pochissimi token di input a disposizione.

Ho creato un notebook jupyter con del codice iniziale, senza filtri applicati al dataset.

Devo capire come "dialogare" in streaming con il modello in modo da interagire dinamicamente con le domande.

---

## **28 ottobre 2025**

Risulta interessante capire come mantenere un contesto per avanzare nel porre domande.
Ciò che devo capire è come mantenerlo: qual è il metodo migliore e come implementarlo nel codice.
Per fare ciò, attualmente, ho adottato un sistema che utilizza una variabile `contex`. Questa variabile mantiene le risposte ad ogni domanda e viene riproposta come contesto prima della domanda successiva.
In questo modo il modello è a conoscenza delle sue risposte precedenti.

Purtroppo LLAMA non risulta essere troppo efficace, nemmeno conoscendo il nome dei registri.

C'è da migliorare le domande e cominciare a salvarsi un po' di risultati per analizzare meglio.

---

## **29 ottobre 2025**

```python
base_prompt = """You are an expert in industrial control systems and in understanding the system architecture by looking at the register values.
In the following, I'll provide you with a list of register values collected over time.

Data:
- This is the scan obtained by observing, for a certain period of time, the contents of the registers of 3 PLCs of an industrial system.
- The first line contains headers that you can use to refer to each register in your answer.

Task:
- The goal is to analyze these values and identify any relationships between columns values.
- Respond clearly with an answer that can be evaluated — in this case, Yes, No or a Number.
"""

q1 = "Q1: Are you able to understand at what type of phisical industrial control system these data refers to?"
q2 = "Q2: Assuming that the industrial system is a water filtration system that certainly uses tanks, are you able to understand how many tanks are involved in the system?"
q3 = "Q3: Are you able to associate the 3 PLCs with the tanks you think you have identified?"
q4 = "Q4: In reality, there are three tanks. Are you able to identify which PLC registers are dedicated to measurements and which to actuations, for each tank?"
q5 = "Q5: In fact, there are three tanks. Are you able to identify which PLC registers are dedicated to measurements and which to actuations, for each tank?"
q6 = "Q6: In fact, there are three tanks. Are you able to identify if there are PLC registers used to store other significant information, such as setpoints or other parameters?"
q7 = "Q7: Considering that there are three tanks, are you able to deduce whether there is a physical connection, i.e., pipes, linking two or more tanks? (This is information that, in our paper, we are not able to derive)"
q8 = "Q8: Assuming you have identified the registers dedicated to containing measurements and actuations for each tank, are you able to construct, for each tank, a chart showing how these quantities, measurements and actuations, evolve over time?"
q9 = "Q9: Are you able to construct a chart representing the operation of the entire system over time?"
q10 = "Q10: For each tank, are you able to extract invariants that relate measurements with actuations?"
q11 = "Q11: Are you able to extract significant invariants that connect the register contents of the entire industrial system?"
```

Oggi ho svolto diverse prove, impostando alcuni parametri differenti.

### **Test 1**
- `baseline.csv` senza compressione
- `meta-llama/llama-3.3-8b-instruct:free`
- header del dataset non Anonimizzato (quindi con i nomi dei registri)
- prime 2000 righe di dataset in analisi
- contesto progressivo nelle chiamate

| Domanda | Commento                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Q1`    | Non individua di preciso la tipologia di sistema, afferma che si tratta di un sistema Modbus o OPC UA                                                                                                                                                                                                                                                                                                                                                                                         |
| `Q2`    | Non stima il numero di tanks                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `Q3`    | Individua 8 tanks: PLC1 (gestisce 1, 2 e 3), PLC2 (gestisce 4 e 5), PLC1 (gestisce 6, 7 e 8). Questa è completamente inventata                                                                                                                                                                                                                                                                                                                                                                |
| `Q4`    | Dandogli il numero di tanks associa PLC1 a Tank1, PLC2 a Tank2 e PLC3 a Tank3, e leggendo il nome del registro capisce la tipologia                                                                                                                                                                                                                                                                                                                                                           |
| `Q5`    | Leggendo il nome del registro capisce la tipologia e il suo presunto contenuto (tra misurazione ed attuazione)                                                                                                                                                                                                                                                                                                                                                                                |
| `Q6`    | Individua i registri $MWx$ come contenitori di setpoints o altri parametri                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `Q7`    | Non è in grado                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `Q8`    | $IWx$ stabili attorno a 10, con alcune fluttuazioni<br>$MWx$ aumentano nel tempo con alcuni drop occasionali<br>$QXxx$ stazionari o cambiano leggermente                                                                                                                                                                                                                                                                                                                                      |
| `Q9`    | Riporta una tabella temporale dei dati                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `Q10`   | Non è in grado                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `Q11`   | Trova delle relazioni ma niente di più tra registri sulla base del fatto che i loro valori cambiano insieme<br>- `PLC1_InputRegisters_IW0` and `PLC2_InputRegisters_IW0`<br>- `PLC1_MemoryRegisters_MW0` and `PLC2_MemoryRegisters_MW0`<br>- `PLC3_Coils_QX00` connected to the `PLC1_Coils_QX00` and `PLC2_Coils_QX00`<br>- `PLC1_MemoryRegisters_MW1` and `PLC3_MemoryRegisters_MW1`<br>- `PLC2_MemoryRegisters_MW1` connected to `PLC1_MemoryRegisters_MW1` and `PLC3_MemoryRegisters_MW1` |


---

## **4 novembre 2025**

### **Test 1**
- `baseline.csv` senza compressione
- `qwen/qwen3-235b-a22b:free`
- header del dataset non Anonimizzato (quindi con i nomi dei registri)
- prime 100 righe di dataset in analisi (poche ma i modelli fanno vomitare se non paghi)
- contesto progressivo nelle chiamate

Qua c'è un bel problema: con solo 100 righe di database il registro che mantiene il livello di Tank3 non viene aggiornato e rimane costante ad 1. Questo causa un errore nell'analisi del modello perché non permette la visualizzazione del trend di crescita e descrescita.

| Domanda | Commento                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Q1`    | "Yes", nessuna specifica in più                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `Q2`    | `PLC1_InputRegisters_IW0` decreases from 81 to 56 while `PLC2_InputRegisters_IW0` increases from 10 to 19.<br>two-tank system where water is transferred from one tank (PLC1) to another (PLC2).<br>**2 tanks** are involved.<br>Stima il numero di tank analizzando l'andamento dei dati nei registri. Inoltre ipotizza uno scambio di liquido tra un tank ed un altro.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `Q3`    | Associa PLC1 e PLC2 a due tank mentre PLC3 (presa in esame rispetto al registro `PLC3_Coils_QX00`) viene definita come una PLC che controlla la logica senza essere associata a nessun tank.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `Q4`    | - `PLC1_InputRegisters_IW0` decreases steadily from 81 → 56 (Tank 1 level dropping)<br>- `PLC2_InputRegisters_IW0` increases steadily from 10 → 19 (Tank 2 level rising)<br>- `PLC3_InputRegisters_IW0` remains constant at 1 (Tank 3 status/level fixed)<br>- Transfer begins when `PLC1_Coils_QX01` and `PLC1_Coils_QX02` switch from 0 → 1<br>Inoltre, il modello cerca di assegnare un ruolo ad ogni tank:<br>- Tank 1 (source tank)<br>- Tank 2 (destination tank)<br>- Tank 3 (static/auxiliary tank)<br>Infine, identifica i registri `MW` come dei contenitori di tresholds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `Q5`    | 1. **Tank 1 (Source Tank):**<br>   - **Measurement:** `PLC1_InputRegisters_IW0` (shows decreasing levels: 81 → 56)<br>   - **Actuation:** `PLC1_Coils_QX01`, `PLC1_Coils_QX02` (toggle from 0 → 1 to initiate liquid transfer)<br>   - **Setpoints/Memory:** `PLC1_MemoryRegisters_MW0=40` (lower threshold), `PLC1_MemoryRegisters_MW1=80` (upper threshold)<br><br>2. **Tank 2 (Destination Tank):**<br>   - **Measurement:** `PLC2_InputRegisters_IW0` (shows increasing levels: 10 → 19)<br>   - **Actuation:** `PLC2_Coils_QX00` (remains active at 1 for inflow control)<br>   - **Setpoints/Memory:** `PLC2_MemoryRegisters_MW0=10` (target level), `PLC2_MemoryRegisters_MW1=20` (maximum capacity?)<br><br>3. **Tank 3 (Static/Auxiliary Tank):**<br>   - **Measurement:** `PLC3_InputRegisters_IW0` (fixed value of 1, likely status flag or overflow indicator)<br>   - **Actuation:** `PLC3_Coils_QX00` (remains inactive, possibly controls overflow valve or heater)<br>   - **Setpoints/Memory:** `PLC3_MemoryRegisters_MW1=10` (unclear context, potential temperature or pressure target?) |
| `Q6`    | 1. **Setpoints (fixed thresholds):**<br>   - `PLC1_MemoryRegisters_MW0=40`: Lower level threshold for Tank 1 (triggers low-level alarm)<br>   - `PLC1_MemoryRegisters_MW1=80`: Upper level limit for Tank 1 (matches when transfer initiates after level drops below 80)<br>   - `PLC2_MemoryRegisters_MW0=10`: Target minimum level for Tank 2 (matches initial level)<br>   - `PLC2_MemoryRegisters_MW1=20`: Maximum capacity for Tank 2 (transfer stops near 19)<br>   - `PLC3_MemoryRegisters_MW1=10`: Auxiliary parameter for Tank 3 (likely overflow threshold)<br><br>2. **Process Parameters:**<br>   - `PLC1_Coils_QX01` & `PLC1_Coils_QX02=1`: Enable transfer valves (activated simultaneously to start flow)<br>   - `PLC2_Coils_QX00=1`: Always-active inflow valve for Tank 2<br>   - `PLC3_InputRegisters_IW0=1`: Constant status flag for Tank 3 (no level change observed)<br><br>3. **Diagnostics:**<br>   - `prev_PLC*_` registers track delta values for anomaly detection (e.g., rapid level changes)<br><br>Interessante come cerca di dare una spiegazione anche i registri `prev_`  |
| `Q7`    | Non in grado, anche se in realtà individua uno scambio tra Tank1 e Tank2. Tutto il ragionamento sfuma perché la domanda chiede tra i TRE tank. A causa dei dati imprecisi il modello non si convince di connessioni per Tank3.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `Q8`    | Afferma che si potrebbero rappresentare i dati con un andamento lineare                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `Q9`    | Crashato                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `Q10`   | Crashato                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `Q11`   | Crashato                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

Qwen sembra dimostrarsi un buon modello d'analisi e dovrebbe essere approfondito maggiormente con configurazioni diverse.