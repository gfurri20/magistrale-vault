Appunti relativi all'analisi del malware d'esame.
Password per il file zippato: `infected`.
Analizzare solo il file che contiene la sotto-procedura: `sub_4020BE`, ovvero `b06ab1f3abf8262f32c3deab9d344d241e4203235043fe996cb499ed2fdf17c4` (113 KB).

# Analisi Statica
Analisi statica del file con PEStudio.

Alcune annotazioni iniziali:
- è un Windows Executable (primi due byte `MZ`) che possiede una GUI
- compilato nel maggio 2019 per CPU a 32 bit
- il nome originale è `dpserver.exe`
- probabilmente il malware si spaccia per un printer server per eseguire azioni malevoli
- la `virtual-size` della sezione `.data` (dati globali) è maggiore di circa $2300$ bytes rispetto alla `raw-size`, questo potrebbe indicare che vengano caricate informazioni aggiuntive durante l'esecuzione (tra l'altro `.data` è anche *writable*)
- l'eseguibile sembra addirittura essere possedere un certificato firmato digitalmente con scadenza nel 2039 (forse tanto nel futuro)

## Il malware è impacchettato?
Il malware **non sembra essere impacchettato**.
### Quale packer è stato utilizzato?
Nessuno.
### Quali sono gli elementi che indicano che il malware è impacchettato?
Di solito se un malware è impacchettato la `signature` del file fa riferimento al metodo di impacchettamento. In questo caso la `signature` corrisponde a `Microsoft Visual C++ 8` che caratterizza un qualsiasi Windows Executable legittimo.
Un altro modo per capire se il malware è impacchettato è quello di analizzare la differenza tra le `raw-size` e `virtual-size`.

## Quali API vengono importate dal malware?
Il malware importa inizialmente quattro `dll`:
- `kernel32.dll`
- `user32.dll`
	- importa una `wsprintfW` che permette di scrivere una stringa formattata in un buffer
- `shlwapi.dll` - libreria che offre alcune funzionalità per la Shell
	- importa `PathFindFileNameW` che cerca un file all'interno di un percorso preso come argomento 
- `winhttp.dll` - libreria che espone un set di funzioni C/C++ che consentono all'applicazione di accedere alle risorse HTTP sul Web.
	- `WinHttpOpen` che inizializza, per un'applicazione, l'uso di funzioni WinHTTP e restituisce un handle di sessione WinHTTP
	- `WinHttpSendRequest` che invia la richiesta specificata al server HTTP relativo alla sessione WinHTTP
	- da documentazione per specificare l'indirizzo del server HTTP è necessario usare `WinHttpConnect`, ???


### Qual è un possibile comportamento del malware in base alle API importate?


## Quali stringhe sono contenute nel malware?
`WinHttpWriteDataWinHttpQueryHeadWinHttpCloseHandWinHttpReceiveReWinHttpOpenRequeWinHttpQueryOptiWinHttpSetOptionWinHttpAddReques\`

### Ci sono stringhe che potrebbero corrispondere a file o a cartelle?

### Ci sono stringhe che potrebbero corrispondere a sotto-chiavi del Windows registry?

### Ci sono stringhe che potrebbero corrispondere ad URL o indirizzi IP?


## Alcune stringhe sono offuscate o cifrate?

### Quale codifica o algoritmo di cifratura viene utilizzato?

