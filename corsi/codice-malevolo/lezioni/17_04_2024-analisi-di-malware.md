to# Malware: `samples/other files/esame2019/sample1`.

## Analisi Statica
Si nota subito che l'exec √® impacchettato con UPX. Quindi si procede subito allo spacchettamento (`upx -d exec -o unpacked`).

Il malware importa `ws2_32.dll` che √® una libreria usata per la comunicazione sulla rete. Quindi fa ampio uso di comunicazione sulla rete.

Inoltre usa le API per gestire i file del sistema (e.g. `CopyFile`).

All'interno delle `strings` ci sono diversi riferimenti all'utilizzo delle mail, magari per trasferire il contenuto di file trafugati üòê.

La chiamata `CreateMutexA` serve per capire se la macchina √® stata gi√† infettata.

## Analisi Dinamica
Da **RegShot** si intuisce come il malware ha creato una serie di file:
- file eseguibili .exe
- file con estensione .com

Inoltre il malware modifica diverse cartelle sotto la cartella Adobe.

Nei registri ci sono svariati riferimenti:
- `lsass.exe`
- ...

Nei servizi c'√® un riferimento a `sample1`, magari per raggiungere persistenza, copiandosi.

Dall'analisi eseguita da **ProcessMonitor** intuiamo che:
- crea il file windows `lsass.exe`
- crea svariati file tmp sotto la cartella AppData/Local
- crea gli altri file visualizzati anche da RegShot

## Analisi del traffico di rete
Durante la fase di analisi statica era chiaro che il malware inviasse mail attraverso SMTP.

Infatti dall'analisi di filosqualo ü¶à si nota che sono stati scambiati svariati pacchetti SMTP.

Se seguiamo il flusso TCP riusciamo a visualizzare l'intero testo della mail.

Sulla macchina dopo l'attacco √® stato creato un file (si chiama tipo Windows Crack) che, se hashato, si ottiene un riscontro interessante: √® la copia dello stesso file.

---

# Analisi di `sample2`
<small>30 aprile 2024</small>

## Analisi statica
Attraverso l'analisi con PESTUDIO si possono raccogliere svariate informazioni sulla natura del malware.

### **General info**
Il file √® un eseguibile per Windows a 32-bit descritto dalla stringa: "Windows Calculator application file".

I time-stamp di compilazioni sembrano, STRANAMENTE, risalire al 2001.
Si pu√≤ gi√† intuire che tale malware tenter√† di ingannare l'utente spaccandosi per l'applicazione della calcolatrice.

Sembra inoltre che sia presente un'interfaccia grafica.

Una delle directories presenta un timestamp particolare: `0xFFFFFFFF` che rappresenta una data sicuramente sbagliata.

### **Sezioni**
L'eseguibile presenta 4 sezioni: `.text`, `.data`, `.rsrc` ed una sospetta nominata `.vmp0`. Quest'ultima risulta essere: <span style="color:#ff0000">writable</span>, <span style="color:#ff0000">executable</span> e <span style="color:#ff0000">self-modifying</span>. Inoltre tale sezione presenta una virtual-size quasi tre volte maggiore della raw-size, altro potenziale fattore di rischio!
La sezione `.vmp0` risulta essere interessante e probabilmente viene utilizzata dal malware per mutare la propria forma ed eseguire codice malevolo (?).

>The VMP (VMProtect) section in an executable refers to a part of the executable that has been protected using VMProtect, a software protection system designed to prevent reverse engineering and tampering.
>The .vmp0 section is assumed to contain virtualized or mutated programmer's code and IAT (Import Address Table) related code. [source](https://whereisr0da.github.io/blog/posts/2021-01-05-vmp-1/)

### **Imports**
Alcuni imports sono segnalati come malevoli da PESTUDIO.
Le API pi√π rischiose importate sono:
- `GetDesktopWindow`, funzione che fa parte dei metodi di gestione del windowing, non √® l'unica API facente parte di questo gruppo ad essere stata importata. (e.g.: `GetWindowTextW`)
- `WinHelpW`, API per introdurre l'help di Windows all'interno dell'applicazione. Da capire perch√© PESTUDIO la segnala come pericolosa.
- `WriteProfileStringW` e `GetProfileIntW`, tali API lavorano con i registri e permettono di andare a modificare e visualizzare informazioni di configurazione di Windows. In realt√† sono funzioni mantenute per la retro-compatibilit√† con i sistemi legacy, non dovrebbero pi√π essere usate.
- `IsClipboardFormatAvailable`, `OpenClipboard`, `GetClipboardData` e `CloseClipboard`, API per la gestione e l'interazione con le informazioni copiate; quindi mantenute nella clipboard.

Queste sono le API importate segnalate da PESTUDIO come pericolose.

Da questa analisi si pu√≤ intuire che il malware interagisce pesantemente con gli elementi GUI forniti dalle Windows API; inoltre tale software interagisce direttamente con dati che potrebbero essere sensibile.
E' molto probabile che un'eventuale password passi per i dati mantenuti nella clipboard.

Inoltre il malware importa diverse API sia per la gestione dei registri sia per la gestione dinamica della memoria (e.g. `LocalAlloc` e `GlobalAlloc`).
Si possono notare anche funzioni per la gestione dei Thread.

### **Strings**
L'eseguibile presenta un numero enorme di stringhe che all'apparenza non significano niente.

Si nota subito un'insieme di stringhe compatibili con un applicazione legit che implementa una calcolatrice. Probabilmente il software all'apparenza risulta esserlo davvero.

Oltre a tali stringhe e le API gi√† analizzate ci sono stringhe che identificano tasti della tastiera (e.g. `CTRL+C` e `BACKSPACE`); stringhe che fanno riferimento all'eseguibile `CALC.exe`.

### **Manifest e version**
Infine, all'interno del file eseguibile √® presente un MANIFEST che √® chiaramente associato all'applicazione `calc.exe` il cui copyright √® proprio posseduto da Windows.

<span style="color:#0070c0">Quindi √® possibile concludere con grande sicurezza che tale malware si finge la calcolatrice per cercare di recuperare informazioni sensibili sulla macchina della vittima.</span>


## Analisi Dinamica
Non ci ho capito tanto, sembra aprire un sacco di file e non utilizzare la rete.

File di log salvati sul desktop di snapshot 3.
Non ho salvato il pcap perch√© sembrava essere inutile.