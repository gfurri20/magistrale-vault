Introduzione al movimento NoSQL e CAP Theorem.
Approfondimento delle tipologie di sistemi NoSQL.


---

# Parentesi su RDBMS
I Relational Database Management Systems sono gli strumenti maggiormente utilizzati nell'ambito delle basi di dati.
Sono sistemi molto conosciuti e per questo ben mantenuti, inoltre l'accesso alle informazioni è facilitato tramite il paradigma ACID.

Nel corso del tempo sono stati evidenziati diversi svantaggi:
- schema dei dati rigido
- difficile da scalare all'aumentare dei dati
- difficile mantenere dati replicati

## ACID
ACID è il paradigma su cui i RDBMS si basano.
- **A**tomicity - ogni transazione è atomica, o ha successo oppure fallisce interamente
- **C**onsistency - i dati sono salvati in maniera consistente, tutti gli utenti visualizzano sempre lo stesso dato
- **I**solation - ogni transazione è indipendente ed isolata dalle altre
- **D**urability - una volta che la transazione viene confermata, lo stato modificato permane

I database moderni fanno riferimento a queste quattro regole, ed ogni sistema che si rispetti le implementa.

**Allentando, però, una di queste regole è possibile aumentare performance e scalabilità** (si riesce a sopperire ai vari svantaggi).


---

# NoSQL
Un sistema NoSQL ha come obiettivo quello di rendere una base di dati:
- libera da schema rigidi
- facile da replicare (aumentare l'affidabilità)
- accessibile tramite API semplici
- eventualmente consistente (non sempre)
- ottima per la gestione di tanti dati distribuiti

Vantaggi di un sistema NoSQL:
- economica e facile da implementare
- adatto a replicazione di dati e partizionamento, quindi facile da distribuire
- non richiede una schema rigido
- scalabile sia in alto che in basso
- allenta i requisiti di consistenza in favore delle altre caratteristiche

Svantaggi di un sistema NoSQL:
- tecnologia nuova, poco supporto e spesso le feature sono buggate
- i dati sono distribuiti e replicati, quindi potrebbe esserci inconsistenza
- nessun standard, né negli schemi, né nelle query e nemmeno nei linguaggi
- difficile applicare schemi esageratamente complicati
- troppe opzioni o sistemi molto simili tra loro, difficile scegliere

I sistemi NoSQL non offrono una soluzione in generale migliore dei classici RDBMS ma permettono, in alcuni casi, di raggiungere prestazioni migliori.

## CAP Theorem
*Delle tre proprietà dei sistemi di dati distribuiti: **consistenza** dei dati, **disponibilità** del sistema e **tolleranza ai guasti** sulle partizioni di rete, solamente due possono essere raggiunte nello stesso momento.*

***Consistenza***
Un sistema distribuito è considerato consistente se dopo la scrittura di un dato, ogni lettore è in grado di leggere la stessa informazione aggiornata.

***Disponibilità***
Un sistema distribuito è considerato disponibile se il funzionamento è costante nel tempo, senza interruzioni.

***Tolleranza ai guasti sulle partizioni di rete***
Un sistema distribuito è considerato tollerante ai guasti sulle partizioni di rete se il funzionamento è costante nel tempo, senza interruzioni, in presenza di partizioni distribuite sulla rete.

### ACID vs BASE
BASE risulta essere un'alternativa di ACID in grado di andare in contro al CAP Theorem nelle sue caratteristiche, allentando le proprietà ACID in favore di disponibilità, degradazione controllata e performance. 

Le caratteristiche nel dettaglio:
- **B**asically **A**vailable - alcuni nodi possono andare down, ma il sistema in generale rimane operativo
- **S**oft State - il sistema risulta essere scalabile con l'aumentare (o diminuire) dei dati (i.e. lo stato del sistema può cambiare nel corso del tempo)
- **E**ventually Consistent - passato un certo lasso di tempo il sistema diventa consistente (i.e. l'aggiornamento non è istantaneo)

L'obiettivo è quello di fornire un paradigma di progettazione per sistemi NoSQL distribuiti.

### Gestione della Consistenza
Se il dataset è replicato e distribuito su diversi nodi, esso può essere modificato su alcuni nodi e, di fatto, la consistenza stretta non può essere garantita dai protocolli che implementano transizioni distribuite (e.g. two-phase-commit).

**Vector Clock** è un protocollo che permette di identificare eventuali conflitti durante l'esecuzione di transazioni distribuite, tale protocollo estende il sistema basato su timestamp in quanto quest'ultimo risulta non essere abbastanza.

**Gossip Protocol** è un protocollo decentralizzato utilizzato per implementare la comunicazione distribuita in un sistema NoSQL.

### Gestione dell'Assegnazione
L'assegnazione dei dati ai nodi è eseguita tramite tecniche di **Partitioning**. 

#### Consistent Hashing
Il **consistent hashing** è una tecnica fondamentale nei sistemi **NoSQL** per **bilanciare la distribuzione dei dati** tra i nodi e **limitare la riassegnazione massiva di chiavi** quando la topologia cambia (aggiunta o rimozione di nodi).

Funzionamento:
- Si rappresenta uno **spazio hash circolare** (es. da 0 a 2³²–1).
- Sia i **nodi** (server) che le **chiavi** (dati) sono mappati sul cerchio tramite una funzione hash
- Una chiave va assegnata al **nodo successivo in senso orario** nel cerchio.

Caratteristiche:
- tutti i buckets ottengono, circa, la stessa quantità di dati
- se un nodo viene rimosso o aggiunto, **solo una piccola frazione** delle chiavi (circa 1/N) cambia assegnazione, senza influenzare l’intero sistema
- per gestire eventuali guasti i dati sono **replicati** sui nodi vicini


---

# NoSQL system types
Esistono svariate tipologie di sistemi NoSQL, ognuno con le proprie caratteristiche e che si adatta meglio in specifici scenari.



