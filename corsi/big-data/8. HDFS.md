Introduzioni agli storage distribuiti ed approfondimento su HDFS.


---

# Hadoop Distributed File System (HDFS)
L'aumentare della grandezza dei dataset ha necessitato un'evoluzione nell'ambito dello storage in quanto la singola macchina non è più sufficiente.

Un file system distribuito:
- costruisce il disco virtuale su una serie di partizioni di rete
- è basato sulla rete quindi si porta dietro tutte le complicazioni relative
- è tollerante ai guasti delle porzioni di rete
- sono progettati per massimizzare il throughput (quantità di data in uscita in un determinato lasso di tempo)
- non gestiscono la concorrenza di netto ma garantiscono replicazione di dati

L'**Hadoop Distributed File System (HDFS)** è il file system distribuito progettato da **Apache Hadoop** per l’archiviazione affidabile e scalabile di grandi volumi di dati su cluster distribuiti di hardware economico.

## Architettura
![HDFS architecture](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9T1HmKhOxOf8DXtZeihnw.png)

***NameNode* (Master)**
- Gestisce la **struttura del namespace** (directory, file, permessi)
- Tiene traccia di **dove sono salvati i blocchi** dei file in RAM
- Non memorizza dati, ma **meta-dati**
- È **singolo punto critico** (anche se oggi si usa l'High Availability)

***DataNode* (Slave)**
- Memorizza effettivamente i **blocchi dei file**
- Esegue operazioni di **lettura/scrittura** dei dati su richiesta del client o del `NameNode`
- Invia periodicamente **heartbeat** al `NameNode` per segnalare lo stato

**Secondary `NameNode`**
- Non è un backup del `NameNode`!
- Serve a **scaricare lo stato del file system** su disco in modo periodico, consolidando i log (file `fsimage` + `edits`)

### Gestione dei file
I file sono **suddivisi in blocchi** (di default 64 o 128 MB), ogni blocco è **replicato** su più `DataNode` (default: **3 copie**).

Le repliche sono distribuite su nodi e rack diversi per garantire **tolleranza ai guasti**.

## Flussi Operativi
Vediamo i flussi operativi per le operazioni di lettura e scrittura.
### Lettura di un file
Flusso operativo in lettura:
1. **Richiesta di lettura del file al `NameNode`**
	- il client invia la richiesta di lettura al `NameNode`
	- il `NameNode` recupera le locazioni del file nel sistema distribuito (ci sono più locazioni perché ci sono le repliche degli stessi blocchi)
2. **Selezione del `DataNode`**
	- il client riceve dal `NameNode` la lista dei `DataNode` che contengono i blocchi, ordinata per posizione più vicina
3. **Lettura**
	- Il client contatta direttamente i `DataNode` selezionati e scarica i blocchi
	- I blocchi vengono ri-assemblati nell'ordine corretto per ricostruire il file

### Scrittura di un file
Flusso operativo in scrittura:
1. **Richiesta di creazione file**
	- Il client contatta il `NameNode` con una richiesta di creazione file.
	- Il `NameNode` verifica:
	    - Se il file esiste già (HDFS non consente overwrite diretto)
	    - I permessi dell’utente
2. **Allocazione dei blocchi**
	- Il `NameNode`:
        - Divide il file in blocchi (es. 128MB)  
	    - Determina i `DataNode` dove scrivere ogni blocco
	    - Restituisce al client la lista dei `DataNode` per il primo blocco (repliche incluse)
3. **Pipeline di scrittura**
	- Il client scrive i dati direttamente ai **`DataNode`** in una **pipeline sequenziale**:
	    - Es. client → DN1 → DN2 → DN3
	- Ogni blocco è scritto e **replicato** simultaneamente lungo questa catena
4. **Conferma scrittura**
	- Ogni `DataNode` conferma al successivo nella catena la ricezione dei dati
	- Alla fine, l’ultimo `DataNode` della catena conferma al client
	- Il client notifica al `NameNode` che il blocco è stato scritto correttamente
5. **Ripetizione per altri blocchi**
	- Il processo si ripete per i blocchi successivi fino a completamento





